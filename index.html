<html>
 <head>
  <script
   src="https://code.jquery.com/jquery-3.2.1.js"
   integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
   crossorigin="anonymous"></script>
  <script src="main.js"></script>
  <script src="midi.js"></script>
  <script>
    jQuery(function() {
        var M = PolyrhythmiaModule(jQuery);
        var game = new M.Game(3, new M.Bounds(0, 0, 640, 480));
        
        var MIDI = MidiModule();
        MIDI.open(navigator, function(midiobj) {
            midiobj.noteOn(0, 64, 127);
        });

        var redraw = function() {
            var ctx = $('#canvas')[0].getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            game.draw(ctx);
        };

        $(document).keydown(function(e) {
            var handled = true;
            switch (e.which) {
                case 32: // space
                    game.insert();
                    redraw();
                    break;
                case 37: // left
                    break;
                case 38: // up
                    game.prevTrack();
                    redraw();
                    break;
                case 39: // right
                    break;
                case 40: // down
                    game.nextTrack();
                    redraw();
                    break;
                default:
                    handled = false;
            }
            if (handled) {
                e.preventDefault();
            }
        });

        redraw();
    });
  </script>
 </head>
 <body>
    <canvas id="canvas" width="640" height="480" style="border: 1px solid black"></canvas>
 </body>
</html>
